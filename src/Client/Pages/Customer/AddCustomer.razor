@using Models
@page "/customer/add"
@layout NoGlobalSearchLayout
@attribute [Authorize(Roles = "Master, Administrator")]

<PageTitle>Klant Toevoegen</PageTitle>



<EditForm  OnValidSubmit="@HandleValidSumbmit" Model="@customerModel">
    <div class="context-menu">
        <span class="context-menu-label">Klant toevoegen</span>
        <Button Text="Toevoegen" OnClick="@HandleValidSumbmit" Href="/customer/list"/>
    </div>
    <DataAnnotationsValidator/>
    <ValidationSummary/>
    <div class="three-column-layout">
        <div class="one-third">
            <Title Text="Algemene informatie" />
            <AddInput Type="@Input.InputType.SELECT" Label="Type van klant" Required="@true" Items="@_typesClient" Action="onChangeType"/>
            @if (_selectedTypeClient == "Intern")
            {
                <AddInput Type="@Input.InputType.SELECT" Label="Instituut" Required="@true" Items="@_institution" BindValue="@customerModel.Institude"/>
                <AddInput Type="@Input.InputType.SELECT" Label="Departement" Required="@true" BindValue="@customerModel.Department" />
                <AddInput Type="@Input.InputType.TEXT" Label="Opleiding" Required="@false" BindValue="@customerModel.Education" />
            }
            else if(_selectedTypeClient == "Extern"){
                <AddInput PlaceHolder="" Type="@Input.InputType.SELECT" Label="Type extern" Required="@true" BindValue="@customerModel.Type" />
                <AddInput Type="@Input.InputType.TEXT" Label="Naam" Required="@true" BindValue="@customerModel.Name" />
            }
        </div>
        <div class="one-third">
            <Title Text="Contactgegevens" />
            <AddInput Type="@Input.InputType.TEXT" Label="Voornaam" Required="@true" BindValue="@customerModel.Firstname" />
            <AddInput Type="@Input.InputType.TEXT" Label="Naam" Required="@true" BindValue="@customerModel.Lastname" />
            <AddInput Type="@Input.InputType.TEXT" Label="E-mailadres" Required="@true" BindValue="@customerModel.Email" />
            <AddInput Type="@Input.InputType.TEXT" Label="Telefoonnummer" BindValue="@customerModel.Phonenumber" />
        </div>
        <div class="one-third">
            <Title Text="Back-up contactgegevens" />
            <AddInput Type="@Input.InputType.TEXT" Label="Voornaam" Required="@_backuprequired" Action="(value) => Makerequired(value)" OptionalId="0" BindValue="@customerModel.BackupFirstname"/>
            <AddInput Type="@Input.InputType.TEXT" Label="Naam" Required="@_backuprequired" Action="(value) => Makerequired(value)" OptionalId="1" BindValue="@customerModel.BackupLastname" />
            <AddInput Type="@Input.InputType.TEXT" Label="E-mailadres" Required="@_backuprequired" Action="(value) => Makerequired(value)" OptionalId="2" BindValue="@customerModel.BackupEmail" />
            <AddInput Type="@Input.InputType.TEXT" Label="Telefoonnummer" BindValue="@customerModel.BackupPhonenumber" />
        </div>
    </div>
</EditForm>


@code {
    private Customer customerModel = new();
    private List<string> _typesClient = new() { "Extern", "Intern" };
    private string _selectedTypeClient="";
    private List<string> _institution = new() {"Hogent", "EhB"};

    private string _customcss = "background-color: white";

    private bool _backuprequired = false;

    private string[] _values = new string[3] { "", "", "" };

    public void Makerequired(string value) {
        int index = int.Parse(value.Substring(0, 1));
        string txt = value.Substring(1);
        _values[index] = txt;

        _backuprequired = _values.All(e => (e == "" || e == null)) ? false : true;
    }

    private void onChangeType(string type){
        _selectedTypeClient = type;
    }

    private void HandleValidSumbmit(){
        Console.WriteLine("Submit plez");
    }
}
